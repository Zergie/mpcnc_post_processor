[gcode_macro PROBE_TOOL]
description: Probes tool and sets tool offset
variable_offset: 2.036
gcode:
  M118 Probe Touchplate (fast)
  PROBE PROBE_SPEED=15 LIFT_SPEED=15 SAMPLES=1 SAMPLE_RETRACT_DIST=1

  M118 Probe Touchplate
  PROBE PROBE_SPEED=5 LIFT_SPEED=15 SAMPLES=3 SAMPLE_RETRACT_DIST=1 SAMPLES_TOLERANCE=0.05 SAMPLES_TOLERANCE_RETRIES=1 SAMPLES_RESULT=average

  G92 Z{% printer["gcode_macro SAVE_Z_RESULT"].value|float + offset|float %}


[gcode_macro SAVE_Z_RESULT]
description: Helper for PROBE_TOOL
variable_value: 0
gcode:
    {% set value = printer.probe.last_z_result %}
    MESSAGE MSG="z_result set to {value}"
